/*
 * menu_file.c
 *
 *  Created on: 16/dic/2011
 *      Author: fhorse
 */

#include <libgen.h>
#include <string.h>
#include "menu_file.h"
#include "recent_roms.h"

#ifdef __SUNPRO_C
#pragma align 4 (open_icon_inline)
#endif
#ifdef __GNUC__
static const guint8 open_icon_inline[] __attribute__ ((__aligned__ (4))) =
#else
static const guint8 open_icon_inline[] =
#endif
{ ""
  /* Pixbuf magic (0x47646b50) */
  "GdkP"
  /* length: header (24) + pixel_data (676) */
  "\0\0\2\274"
  /* pixdata_type (0x2010002) */
  "\2\1\0\2"
  /* rowstride (64) */
  "\0\0\0@"
  /* width (16) */
  "\0\0\0\20"
  /* height (16) */
  "\0\0\0\20"
  /* pixel_data: */
  "\221\377\377\377\0\1\200\200\200\4\204\200\200`\10\1UUU\3\211\377\377"
  "\377\0\2txbuvye\371\203wzf\374\3wyf\374vye\360rtd\\\210\377\377\377\0"
  "\1uxc\364\202\265\267\250\377\6\263\265\246\377\262\264\244\377\260\262"
  "\241\377\252\254\233\377y|g\365sxd3\207\377\377\377\0\2svc\373\262\264"
  "\244\377\204\220\223|\377\3\236\241\215\377\236\240\217\376vye\373\203"
  "twc\377\6twd\377tvc\377uxc\367sxdspr^\373\250\252\231\377\202\220\223"
  "|\377\2z|m\377WYU\377\206UWS\377\6WYU\377\201\203v\377\226\230\204\377"
  "os`\367ln[\373\224\227\204\377\202\204\207q\377\2WYU\377\373\373\373"
  "\377\206\377\377\377\377\6\373\373\373\377WYU\377\211\214v\377kn[\377"
  "giW\373}\177m\377\202wye\377\2UWS\377\377\377\377\377\206\272\275\266"
  "\377\5\377\377\377\377UWS\377wye\377gjX\377deT\373\203jkY\377\2UWS\377"
  "\377\377\377\377\206\356\356\354\377\5\377\377\377\377UWS\377jkY\377"
  "dfU\377_aP\373\203ggV\377\3UWS\377\377\377\377\377\272\275\266\377\205"
  "\270\273\263\377\5\373\373\372\377VXS\377ggW\377`bQ\377[\\M\373\203g"
  "gV\377\3XZU\377\255\257\242\377y|i\377\203x{g\377\203wzf\377\202uxd\377"
  "\2rta\377fiW\375\203lo\\\377>ps`\377\240\241\221\377\277\277\263\377"
  "\304\305\271\377\303\304\270\377\302\303\267\377\301\301\266\377\300"
  "\300\265\377\277\277\264\377\275\276\262\377\271\271\255\377jlZ\377a"
  "cR\377\277\301\263\377\304\305\270\377\302\303\266\377\301\301\264\377"
  "\267\271\252\377\253\255\234\377\247\250\226\377\246\250\226\377\244"
  "\246\224\377\244\245\224\377\243\245\223\377\241\243\222\377\241\242"
  "\221\377\263\265\250\377abR\377WXJ\377\303\305\270\377\270\272\253\377"
  "\271\272\252\377\270\272\253\377\267\270\251\377\266\270\251\377\267"
  "\267\251\377\264\266\247\377\263\265\246\377\262\263\244\377\260\261"
  "\243\377\257\261\242\377\254\256\240\377\260\261\243\377WXJ\377RRE\375"
  "\233\233\210\377\254\254\232\377\255\255\233\377\256\256\234\377\257"
  "\257\236\377\260\260\237\377\261\261\241\377\257\257\237\377\255\255"
  "\234\377\252\252\231\377\247\247\227\377\245\245\223\377\242\242\220"
  "\377\214\214z\377QQC\376NN@oNNB\365\214JJ>\377\2NNB\365MM@p"};

#ifdef __SUNPRO_C
#pragma align 4 (recent_roms_icon)
#endif
#ifdef __GNUC__
static const guint8 recent_roms_icon[] __attribute__ ((__aligned__ (4))) =
#else
static const guint8 recent_roms_icon[] =
#endif
{ ""
  /* Pixbuf magic (0x47646b50) */
  "GdkP"
  /* length: header (24) + pixel_data (711) */
  "\0\0\2\337"
  /* pixdata_type (0x2010002) */
  "\2\1\0\2"
  /* rowstride (64) */
  "\0\0\0@"
  /* width (16) */
  "\0\0\0\20"
  /* height (16) */
  "\0\0\0\20"
  /* pixel_data: */
  "\203\377\377\377\0\1\364\2404\350\204\364\2415\377\5\364\2414\377\365"
  "\2558\377\366\265<\377\366\2579\354\377\377\0\1\206\377\377\377\0\13"
  "\354\223+\377\375\313\201\377\375\312\177\377\375\311}\377\375\313y\377"
  "\374\332c\377\374\341R\377\357\326(\377\347\316\32\377\370\344C\225\377"
  "\353N\32\205\377\377\377\0\2\344\205\40\377\376\331\242\377\202\375\305"
  "r\377\7\374\330`\377\374\351O\377\364\337-\377\362\341a\377\362\344w"
  "\377\360\330-\377\373\351O\216\205\377\377\377\0\14\335y\27\377\376\346"
  "\302\377\376\326\234\377\375\331\220\377\366\335@\377\356\326\33\377"
  "\354\325\24\377\374\371\341\377\375\372\347\377\344\312\22\377\344\313"
  "\32\372\345\313\34v\204\377\377\377\0\5\326k\15\377\376\351\315\377\375"
  "\331\250\377\375\336\213\377\347\317\30\377\204\377\377\377\377\3\377"
  "\377\372\377\377\377\377\377\334\300\12\365\204\377\377\377\0\7\317^"
  "\4\377\375\343\302\377\374\314\221\377\374\326|\377\356\327+\377\354"
  "\330K\377\377\377\375\377\202\377\377\377\377\3\377\375\353\377\347\322"
  "E\377\342\310\32\302\204\377\377\377\0\14\317^\4\377\375\333\265\377"
  "\373\277z\377\373\305s\377\373\342V\377\344\311\24\377\374\370\335\377"
  "\377\376\363\377\377\374\350\377\371\361\270\377\337\301\21\374\377\345"
  "K:\204\377\377\377\0\2\317^\3\377\374\321\242\377\202\372\262c\377\10"
  "\373\317X\377\337\304\23\377\377\377\377\377\360\341y\377\361\341z\377"
  "\377\377\377\377\331\273\11\371\377\377\0\1\204\377\377\377\0\2\317^"
  "\3\377\373\305\215\377\202\371\244L\377\7\370\251L\377\346\301%\377\334"
  "\275\13\377\346\313&\377\342\303\37\377\330\271\10\372\330\275\21\245"
  "\205\377\377\377\0\2\317^\3\377\372\270v\377\204\370\2275\377\4\370\247"
  ":\377\373\313r\377\331z\22\377\377\377U\3\206\377\377\377\0\2\316]\2"
  "\377\371\252\\\377\205\367\212\36\377\2\372\261h\377\317^\3\377\207\377"
  "\377\377\0\11\316]\2\377\367\233@\377\365}\7\377\366\216(\377\367\235"
  "D\377\366\217*\377\365}\7\377\370\242N\377\317^\3\377\207\377\377\377"
  "\0\11\316]\2\377\367\221.\377\366\210\34\377\357\210(\377\325f\11\364"
  "\357\212,\377\366\213\"\377\367\231=\377\316]\2\377\207\377\377\377\0"
  "\11\316]\1\377\366\213#\377\356\202\35\377\320^\2\363\315[\0p\320^\2"
  "\363\357\206%\377\367\2232\377\316]\2\377\207\377\377\377\0\11\316\\"
  "\1\377\355|\21\377\320^\1\363\314^\0<\377\377\377\0\314^\0<\320^\2\363"
  "\356\202\35\377\316]\1\377\207\377\377\377\0\3\317\\\0\350\317]\1\365"
  "\314^\0<\203\377\377\377\0\3\314^\0<\317^\2\365\317\\\0\350\204\377\377"
  "\377\0"};

#ifdef __SUNPRO_C
#pragma align 4 (quit_icon_inline)
#endif
#ifdef __GNUC__
static const guint8 quit_icon_inline[] __attribute__ ((__aligned__ (4))) =
#else
static const guint8 quit_icon_inline[] =
#endif
{ ""
  /* Pixbuf magic (0x47646b50) */
  "GdkP"
  /* length: header (24) + pixel_data (920) */
  "\0\0\3\260"
  /* pixdata_type (0x2010002) */
  "\2\1\0\2"
  /* rowstride (64) */
  "\0\0\0@"
  /* width (16) */
  "\0\0\0\20"
  /* height (16) */
  "\0\0\0\20"
  /* pixel_data: */
  "\1Z\\X\205\206UWS\377\3WYU\377\\^Z\377dfc\377\202hjg\377\16fgd\377`b"
  "^\377`b^\207\377\377\377\1UWS\377\244\244\244\377\204\204\204\377yyy"
  "\377ooo\377ggg\377aaa\377ccc\377\361\361\357\377\364\364\363\377\202"
  "\366\366\365\377\16\365\365\364\377\351\351\350\377cea\377\377\377\377"
  "\3UWS\377\256\256\256\377\214\214\214\377\201\201\201\377www\377ooo\377"
  "jjj\377nnn\377\363\363\362\377\370\370\370\377\202\373\373\373\377\77"
  "\371\371\371\377\365\365\364\377lnk\377\377\377\377\5UWS\377\272\272"
  "\272\377\230\230\230\377\214\214\214\377\202\202\202\377yyy\377sss\377"
  "xxx\377\337\264\262\377\264..\377\264//\377\355\317\317\377\373\373\372"
  "\377\366\366\365\377oqm\377\377\377\377\5UWS\377\274\274\274\377\236"
  "\236\236\377\225\225\225\377\214\214\214\377\202\202\202\377|||\377\203"
  "oo\377\253\20\16\377\353j-\377\347`)\377\264-,\377\373\373\372\377\366"
  "\366\365\377oqm\377\377\377\377\6UWS\377\276\276\276\377\240\240\240"
  "\377\230\230\230\377\217\217\217\377\207\207\207\377\200\177\177\377"
  "\233\"\"\377\331I\37\377\356c+\377\345T%\377\271;:\377\373\373\372\377"
  "\366\366\365\377pqn\377\377\377\377\6UWS\377\277\277\277\377\243\243"
  "\243\377\232\232\232\377\222\222\222\377\211\211\211\377\217LL\377\274"
  "\34\14\377\360v.\377\335\34\25\377\260\4\4\377\203\244\0\0\377\14\234"
  "\22\21\377\255\27\27""8UWS\377\277\277\277\377\245\245\245\377\234\234"
  "\234\377\224\224\224\377\216zz\377\244\7\7\377\351i(\377\3372\27\377"
  "\3373\30\377\204\361~/\377\14\340U\40\377\243\1\1\313UWS\377\277\277"
  "\277\377\247\247\247\377\237\237\237\377\226\226\226\377\220}}\377\235"
  "\10\7\377\325.\22\377\320\5\5\377\325\33\14\377\203\320\5\5\377\16\321"
  "\7\6\377\316-\21\377\236\3\3\277UWS\377\277\277\277\377\252\252\252\377"
  "\241\241\241\377\231\231\231\377\220\220\220\377\216QQ\377\242\3\3\377"
  "\320\17\15\377\353r+\377\257\35\14\377\203\225\0\0\377;\214\32\31\377"
  "\236\24\24\77UWS\377\277\277\277\377\253\253\253\377\243\243\243\377"
  "\233\233\233\377\222\222\222\377\214\213\213\377\217&&\377\273!!\377"
  "\350W<\377\352x8\377\236&&\377\366\367\366\377\356\356\355\377pqn\377"
  "\377\377\377\6UWS\377\277\277\277\377\253\253\253\377\246\246\246\377"
  "\236\236\236\377\230\230\230\377\225\225\225\377\221\201\201\377\213"
  "\13\13\377\331TP\377\335hG\377\23777\377\361\361\357\377\347\350\345"
  "\377mok\377\377\377\377\5UWS\377\277\277\277\377\254\254\254\377\252"
  "\252\252\377\246\246\246\377\242\242\242\377\177\177\177\377\233\234"
  "\233\377\306\253\251\377\22500\377\232<;\377\320\264\262\377\345\346"
  "\344\377\335\336\333\377gie\377\377\377\377\3VXT\377\300\300\300\377"
  "\256\256\256\377\264\264\263\377\215\215\215\377\226\227\224\377\314"
  "\316\311\377\327\331\325\377\330\332\326\377\203\331\333\327\377\13\326"
  "\330\324\377\320\323\316\377`b^\377\377\377\377\3WYU\377\306\306\306"
  "\377\233\233\232\377\225\227\224\377\301\304\277\377\306\311\303\377"
  "\306\311\304\377\205\307\311\304\377\6\306\310\303\377\302\305\277\377"
  "Y[W\377\377\377\377\1""554\247klj\377\202XZV\377\211Y[W\377\3WYU\377"
  "\\^Z\205\377\377\377\0"};

void menu_file_recent_roms_activate(gint index);

static GtkWidget *recent;

void menu_file(GtkWidget *mainmenu, GtkAccelGroup *accel_group) {
	GtkWidget *menu, *file, *open, *quit;

	menu = gtk_menu_new();
	file = gtk_menu_item_new_with_mnemonic("_File");

	/* append menu file to main menu */
	gtk_menu_shell_append(GTK_MENU_SHELL(mainmenu), file);
	gtk_menu_item_set_submenu(GTK_MENU_ITEM(file), menu);

	open = gtk_image_menu_item_new_with_mnemonic("_Open");
	recent = gtk_image_menu_item_new_with_mnemonic("Recent Roms");
	quit = gtk_image_menu_item_new_with_mnemonic("E_xit");

	/* icons */
	icon_inline(open, open_icon_inline)
	icon_inline(recent, recent_roms_icon)
	icon_inline(quit, quit_icon_inline)

	/* accelerators */
	gtk_widget_add_accelerator(open, "activate", accel_group, GDK_o, GDK_CONTROL_MASK,
			GTK_ACCEL_VISIBLE);
	gtk_widget_add_accelerator(quit, "activate", accel_group, GDK_q, GDK_CONTROL_MASK,
			GTK_ACCEL_VISIBLE);

	/* append menu shell */
	gtk_menu_shell_append(GTK_MENU_SHELL(menu), open);
	gtk_menu_shell_append(GTK_MENU_SHELL(menu), recent);
	gtk_menu_shell_append(GTK_MENU_SHELL(menu), gtk_separator_menu_item_new());
	gtk_menu_shell_append(GTK_MENU_SHELL(menu), quit);

	/* signals */
	g_signal_connect(G_OBJECT(open), "activate", G_CALLBACK(file_open), NULL);
	g_signal_connect(G_OBJECT(quit), "activate", G_CALLBACK(main_win_delete_event), NULL);
}
void menu_file_check(void) {
	GtkWidget *submenu;

	gtk_widget_hide_all(recent);

	gtk_menu_item_set_submenu(GTK_MENU_ITEM(recent), NULL);

	if (recent_roms_list.count > 0) {
		gint index;

		submenu = gtk_menu_new();
		gtk_menu_item_set_submenu(GTK_MENU_ITEM(recent), submenu);

		for (index = 0; index < RECENT_ROMS_MAX; index++) {
			GtkWidget *slot;
			char description[RECENT_ROMS_LINE];

			if (recent_roms_list.item[index][0] == 0) {
				break;
			}

			sprintf(description, "%2d.\t%s", index + 1, basename(recent_roms_list.item[index]));
			slot = gtk_menu_item_new_with_mnemonic(description);

			gtk_menu_shell_append(GTK_MENU_SHELL(submenu), slot);

			g_signal_connect_swapped(G_OBJECT(slot), "activate",
			        G_CALLBACK(menu_file_recent_roms_activate), GINT_TO_POINTER(index));
		}
	}

	gtk_widget_show_all(recent);
}

void menu_file_recent_roms_activate(gint index) {
	emu_pause(TRUE);

	if (strncmp(recent_roms_list.current, recent_roms_list.item[index],
	        RECENT_ROMS_LINE) != 0) {
		change_rom(recent_roms_list.item[index]);
	}

	emu_pause(FALSE);
}
